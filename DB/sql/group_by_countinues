SELECT  MIN(id) AS id, MIN(ts) AS ts, MIN(state) AS state, COUNT(*) cnt
FROM    (
        SELECT  @r := @r + (@state != state) AS gn,
                @state := state AS sn,
                s.*
        FROM    (
                SELECT  @r := 0,
                        @state := 0
                ) vars,
                t_state s
        ORDER BY
                ts
        ) q
GROUP BY
        gn


here @r is variable inititalized with 0 and increments every time the state changes


SELECT  @r := @r + (@state != state) AS gn,@state := state as sn,s.* FROM  ( SELECT  @r := 0,@state := 0 ) vars, t_state s ORDER BY ts

SELECT  @r := @r+(@state != state) AS gn,@state := state as sn,s.* FROM  ( SELECT  @r := 0,@state := 0 ) vars, t s ORDER BY ts


Table creation scripts for testing:

CREATE TABLE t_state (id INT NOT NULL PRIMARY KEY, state INT NOT NULL, ts DATETIME NOT NULL);

INSERT
INTO  t_state
VALUES
(12,   1,      '2009-07-16 10:00'),
(45,   2,      '2009-07-16 13:00'),
(67,   2,      '2009-07-16 14:40'),
(77,   1,      '2009-07-16 15:00'),
(89,   1,      '2009-07-16 15:30'),
(99,   1,      '2009-07-16 16:00');




Insert into t values (1509741795,'nlpcaptcha1e56a1842adc7dd0f883b29f683869e1',1496079674),(1509741795,'nlpcaptcha1e56a1842adc7dd0f883b29f683869e1',1496079674),(1509741795,'nlpcaptcha1e56a1842adc7dd0f883b29f683869e1',1496079674),(1509741795,'nlpcaptcha1e56a1842adc7dd0f883b29f683869e1',1496079674),(1509741795,'nlpcaptcha1e56a1842adc7dd0f883b29f683869e1',1496079674),(1509741795,'nlpcaptcha1e56a1842adc7dd0f883b29f683869e1',1496079674),(1509741795,'nlpcaptcha1e56a1842adc7dd0f883b29f683869e1',1496079674),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067303),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067303),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067303),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067303),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067303),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067303),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067303),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067303),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067303),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067303),(1509741795,'nlpcaptchadf576a7285579f09822fee15242b9d71',1496024341),(1509741795,'nlpcaptchadf576a7285579f09822fee15242b9d71',1496024341),(1509741795,'nlpcaptchadf576a7285579f09822fee15242b9d71',1496024341),(1509741795,'nlpcaptchadf576a7285579f09822fee15242b9d71',1496024341),(1509741795,'nlpcaptchadf576a7285579f09822fee15242b9d71',1496024341),(1509741795,'nlpcaptchadf576a7285579f09822fee15242b9d71',1496024341),(1509741795,'nlpcaptchadf576a7285579f09822fee15242b9d71',1496024341),(1509741795,'nlpcaptchadf576a7285579f09822fee15242b9d71',1496024341),(1509741795,'nlpcaptchadf576a7285579f09822fee15242b9d71',1496024341),(1509741795,'nlpcaptchadf576a7285579f09822fee15242b9d71',1496024341),(1509741795,'nlpcaptcha1e56a1842adc7dd0f883b29f683869e1',1496079670),(1509741795,'nlpcaptcha1e56a1842adc7dd0f883b29f683869e1',1496079670),(1509741795,'nlpcaptcha1e56a1842adc7dd0f883b29f683869e1',1496079670),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067263),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067263),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067263),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067263),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067263),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067263),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067263),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067263),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067263),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067263),(1509741795,'nlpcaptchad395382d15b32239dcbd29ecb0622816',1496038252),(1509741795,'nlpcaptchad395382d15b32239dcbd29ecb0622816',1496038252),(1509741795,'nlpcaptchad395382d15b32239dcbd29ecb0622816',1496038252),(1509741795,'nlpcaptchad395382d15b32239dcbd29ecb0622816',1496038252),(1509741795,'nlpcaptchad395382d15b32239dcbd29ecb0622816',1496038252),(1509741795,'nlpcaptchad395382d15b32239dcbd29ecb0622816',1496038252),(1509741795,'nlpcaptchad395382d15b32239dcbd29ecb0622816',1496038252),(1509741795,'nlpcaptchad395382d15b32239dcbd29ecb0622816',1496038252),(1509741795,'nlpcaptchab4bba6741d508c97df0916085311dfc2',1496067313),(1509741795,'nlpcaptchad395382d15b32239dcbd29ecb0622816',1496038251),(1509741795,'nlpcaptchad395382d15b32239dcbd29ecb0622816',1496038251)
